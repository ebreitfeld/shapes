<!DOCTYPE html>
<html>

<head>
  <title>Funct Experiment</title>
  <meta charset="utf-8"/>
  <script src="jspsych-6.1.0/jspsych.js"> </script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response-flexiblelocations.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
  <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css",type="text/css"> </link>
  <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
  <style>
  div.absolute {
    position: absolute;
    left: 10px;
    right: 0px;
    top: 10px;
    border: 3px solid #73AD21;
  }
  </style>
</head>
<body>
  <div id="funct-study"></div>
</body>

<script>


/* Enter subject id */
var subject_id = prompt("Enter subject id", "test");
var lwl_trial_order = prompt("Order (1 or 2)","1");

/* read from a public spreadsheet for LWL trials */
var publicSpreadsheetUrl_lwl = 'https://docs.google.com/spreadsheets/d/1hMjDFj3WZIpIq6BZ0CjtqxWF0s4FZ4G4SqMKE99WiaQ/edit?usp=sharing';

var tabletop_lwl = Tabletop.init( { key: publicSpreadsheetUrl_lwl,
                   callback: startExperimentLWL,
                   simpleSheet: false })

/* read from a public spreadsheet for video trials */
/*
var publicSpreadsheetUrl_plp = 'https://docs.google.com/spreadsheets/d/13byAZJymu1H_-3Que5dEN1tW-3E2mh1vMBh-6E3vTbg/edit?usp=sharing';

var tabletop_plp = Tabletop.init( { key: publicSpreadsheetUrl_plp,
                   callback: startExperimentPLP,
                   simpleSheet: false }) */

document.body.style.backgroundColor = "black";
document.body.style.backgroundSize = "100%";
document.body.style.backgroundPosition = "top";
document.body.style.backgroundRepeat = "no-repeat";

/* create experiment timeline*/
var timeline = []

/* extract the elements from the CSV */
function createLWLTrials(data_lwl, tabletop_lwl) {

  data_lwl = data_lwl['Order_'+lwl_trial_order]['elements']
  console.log(data_lwl);

/* display start screen */
  var welcome_LWL = {
    type: "fullscreen",
    message: "The study is loaded and ready to begin. Please wait for the experimenter for instructions.",
    button_label: "Start",
    delay_after: 250
  }

  timeline.push(welcome_LWL);

  var expLength = data_lwl.length;
  var audioExt="stimuli/sounds/"
  var imageStart='<img src= "stimuli/images/'
  var imageStop='.jpg"  title = "" width="250" height="250">'


  lwl_stimuli = []
/* set up for a LWL trial with audio and 2 images */
  for (var i = 0; i < expLength; i++) {
    lwl_stimuli.push(
    {stimulus: audioExt+data_lwl[i]['auditory_stimulus']+".wav",
    choices:[imageStart+data_lwl[i]['left_image']+imageStop, imageStart+data_lwl[i]['right_image']+imageStop],
    set_background:data_lwl[i]['background'],
    data:{
		left_image: data_lwl[i]['left_image'],
		right_image: data_lwl[i]['right_image'],
		target_label: data_lwl[i]['target_label'],
		target_side:data_lwl[i]['target_side'],
		correct_response:data_lwl[i]['correct_response'],
		background:data_lwl[i]['background']}
    })
  }

/* define the location of the stimuli */
  var lwl_trials = {
    type: 'audio-button-response-flexiblelocations',
    trial_duration: 3500,
    margin_top: ['300px','300px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','250px'],
    margin_right: ['250px','0px'],
    timeline: lwl_stimuli,
	  response_possible: false,
    data: jsPsych.timelineVariable('data_lwl'),
	  response_ends_trial: false,
    on_finish: function(data_lwl) {
      data_lwl.correct = data_lwl.button_pressed == data_lwl.correct_response;
    }
  }

  timeline.push(lwl_trials);

/* begin PLP experiment structure
  function createPLPTrials(data_plp, tabletop_plp) {

    data_plp = data_plp['Order_'+plp_trial_order]['elements']
    console.log(data_plp);

    var welcome_PLP = {
      type: "fullscreen",
      message: "Please take a short rest if you or your child need one.",
      button_label: "Start",
      delay_after: 250
    }

    timeline.push(welcome_PLP);

    var expLength = data_plp.length;
    var audioExt="stimuli/sounds/"
    var videoStart='<img src= "stimuli/videos/'
    var videoStop='.mp4"  title = "" width="250" height="250">'


    plp_stimuli = []

    for (var i = 0; i < expLength; i++) {
      plp_stimuli.push(
      {stimulus: audioExt+data_plp[i]['auditory_stimulus']+".wav",
      choices:[videoStart+data_plp[i]['left_video']+videoStop, videoStart+data_plp[i]['right_video']+videoStop],
      set_background:data_plp[i]['background'],
      data:{
  		left_video: data_plp[i]['left_video'],
  		right_video: data_plp[i]['right_video'],
  		atypical_side:data_plp[i]['atypical_side'],
  		correct_response:data_plp[i]['correct_response'],
  		background:data_plp[i]['background']}
      })
    }


    var plp_trials = {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 6500,
      margin_top: ['300px','300px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','250px'],
      margin_right: ['250px','0px'],
      timeline: plp_stimuli,
  	  response_possible: false,
      data: jsPsych.timelineVariable('data_plp'),
  	  response_ends_trial: false,
      on_finish: function(data_plp) {
        data_plp.correct = data_plp.button_pressed == data_plp.correct_response;
      }
    }

    timeline.push(plp_trials); */

  var fullscreen_exit = {
    type: 'fullscreen',
    fullscreen_mode: false
  }
  timeline.push(fullscreen_exit)
};


var imageExt = 'stimuli/images/'


var images = [
"apple01.jpg",
"apple02.jpg",
"apple03.jpg",
"ball01.jpg",
"ball02.jpg",
"ball03.jpg",
"balloons_left.jpg",
"balloons_right.jpg",
"beach_left.jpg",
"beach_right.jpg",
"black-background.jpg",
"black.jpg",
"crayon01.jpg",
"crayon02.jpg",
"crayon03.jpg",
"fireworks_left.jpg",
"fireworks_right.jpg",
"ocean_left.jpg",
"ocean_right.jpg",
"toothbrush01.jpg",
"toothbrush02.jpg",
"toothbrush03.jpg"
]

var preload_images=[];

for (var k = 0; k < images.length; k++) {
	preload_images.push(imageExt+images[k]);
};

var audio = [
	"AG.wav",
  "apple_find.wav",
  "apple_look.wav",
  "apple_where.wav",
  "ball_find.wav",
  "ball_look.wav",
  "ball_where.wav",
  "crayon_find.wav",
  "crayon_look.wav",
  "crayon_where.wav",
  "toothbrush_find.wav",
  "toothbrush_look.wav",
  "toothbrush_where.wav"
];

var preload_audio  = [];

for (var l = 0; l < preload_audio.length; l++) {
	preload_audio.push(imageExt+audio[l]);
};

function startExperimentLWL(data_lwl, tabletop_lwl) {
	createLWLTrials(data_lwl,tabletop_lwl);
jsPsych.init({
  timeline: timeline,
  preload_audio:preload_audio,
  preload_images:preload_images,
	default_iti: 300,
  on_finish: function() {
    jsPsych.data_lwl.displayData();
  }
});
};

/*
function save_data(experiment, version,identifier, data){
 	$.ajax({
 		type: 'post',
 		cache: false,
 		url: 'https://data.infantlearning.waisman.wisc.edu/infantdb/datastore/save/',
 		data: {
 			experiment: experiment,
 	version: version,
 			identifier: identifier,
 			data: data
 		}
 	})
 };
*/


</script>

</html>
