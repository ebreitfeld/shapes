<!DOCTYPE html>
<html>

<head>
  <title>Funct Experiment</title>
  <meta charset="utf-8"/>
  <script src="jspsych-6.1.0/jspsych.js"> </script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response-flexiblelocations.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
  <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css",type="text/css"> </link>
  <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
  <style>
  div.absolute {
    position: absolute;
    left: 10px;
    right: 0px;
    top: 10px;
    border: 3px solid #73AD21;
  }
  </style>
</head>
<body>
  <div id="jspsych-lwl"></div>
</body>

<script>



/* Enter subject id */
var subject_id = prompt("Enter subject id", "test");
//var trial_order = prompt("Order (1 or 2)","1");
var plp_order = prompt("Order(1 or 2)","1");

// read from a public spreadsheet for LWL trials
// use the publish link NOT the sharing link
/*
if (trial_order == "1") {
	var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQf0TTaR_AlCKCIKsB7mchq6TLzKHWlnidWmepBMuro3A5zNWLsrjUY-dGJmGJvX_QLOD85GKIhPLHS/pub?gid=2061099652&single=true&output=csv'
} else if (trial_order =="2") {
	var publicSpreadsheetUrl =
	'https://docs.google.com/spreadsheets/d/e/2PACX-1vQf0TTaR_AlCKCIKsB7mchq6TLzKHWlnidWmepBMuro3A5zNWLsrjUY-dGJmGJvX_QLOD85GKIhPLHS/pub?gid=37901528&single=true&output=csv'
}
*/

//var publicSpreadsheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTRRqgdruYPdxuUKqAlE0x85QwIRQuGDljRbBEbk3ixv0dEw7bFFQNLdB6M10LWNRS_Ae-5XR_X9P5O/pub?gid=2061099652&single=true&output=csv'

//use a spreadsheet that only has one line per stim
var publicSpreadsheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQj1ADE5e3LSz0FDNR6qJ-XB-TsUqGZE-BNVZNLHqYPt59CZi55L08LQRS93A-Dopl2PgFqcdBRJf0Y/pub?gid=2061099652&single=true&output=csv'
// read from a public spreadsheet for video trials
///var plp_publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTRRqgdruYPdxuUKqAlE0x85QwIRQuGDljRbBEbk3ixv0dEw7bFFQNLdB6M10LWNRS_Ae-5XR_X9P5O/pub?output=csv';


//lwl orders
Papa.parse(publicSpreadsheetURL,{
  download: true,
  header: true,
  dynamicTyping: true,
  complete: function(results) {
    var data = results.data
    console.log(data)
    startExperiment(data); //don't start experiment until the spreadsheet is downloaded
  }
})


document.body.style.backgroundColor = "black";
document.body.style.backgroundSize = "100%";
document.body.style.backgroundPosition = "top";
document.body.style.backgroundRepeat = "no-repeat";

/* create experiment timeline*/
var timeline = []

/* extract the elements from the CSV */
function createTrials(data) {
  console.log(data);

/* display start screen */
  var welcome = {
    type: "fullscreen",
    message: "",
    button_label: "Start",
    delay_after: 250
  }

  timeline.push(welcome);

  var expLength = data.length;
  //var plpExtLength = plp_data.length;
  var audioExt="stimuli/sounds/"
  //var imageStart='<img src= "stimuli/images/'
  //var imageStop='.jpg"  title = "" width="400" height="400">'
  var videoStart = "stimuli/videos/"
  var videoStop = ".mp4"

/*
  lwl_stimuli = []
// set up for a LWL trial with audio and 2 images
  for (var i = 0; i < expLength; i++) {
    lwl_stimuli.push(
    {stimulus: audioExt+data[i]['auditory_stimulus']+".wav",
    choices:[imageStart+data[i]['left_image']+imageStop, imageStart+data[i]['right_image']+imageStop],
    set_background:data[i]['background'],
    data:{
		left_image: data[i]['left_image'],
		right_image: data[i]['right_image'],
		target_label: data[i]['target_label'],
		target_side: data[i]['target_side'],
		correct_response: data[i]['correct_response'],
		background: data[i]['background']}
    })
  }

//define the location of the stimuli
  var lwl_trials = {
    type: 'audio-button-response-flexiblelocations',
    trial_duration: 3500,
    margin_top: ['300px','300px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','200px'],
    margin_right: ['89px','0px'],
    timeline: lwl_stimuli,
	  response_possible: false,
    data: jsPsych.timelineVariable('data'),
	  response_ends_trial: false,
    on_finish: function(data) {
      data.correct = data.button_pressed == data.correct_response;
    }
  }

  timeline.push(lwl_trials);
*/


// set up for a LWL trial with audio and 2 images
for (var i = 0; i < expLength; i++) {
  //define stimuli variables
  var cur_stimulus = audioExt+data[i]['auditory_stimulus']+".wav";
  var cur_left_video = videoStart+data[i]['left_video']+videoStop;
  var cur_right_video = videoStart+data[i]['right_video']+videoStop;
  var cur_side1 = data[i]['side1'];

  //define html buttons
  var cur_left_button = '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="'+cur_left_video+'" type="video/mp4"></video></div>';
  var cur_right_button = '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="'+cur_right_video+'" type="video/mp4"></video></div>';
  var cur_left_button_play = '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="'+cur_left_video+'" type="video/mp4"></video></div>';
  var cur_right_button_play = '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="'+cur_right_video+'" type="video/mp4"></video></div>';

  //define set up visual display
  var cur_background = data[i]['background'];

  if (cur_side1 == "right") {
    var button_html_1 = [cur_left_video_button,cur_right_video_button_play];
    var button_html_2 = [cur_left_video_button_play,cur_right_video_button];
  } else {
    var button_html_1 = [cur_left_video_button_play,cur_right_video_button];
    var button_html_2 = [cur_left_video_button,cur_right_video_button_play];
  }

  var plp_trial_1= {
    //present 1st video
    type: 'audio-button-response-flexiblelocations',
    stimulus: cur_stimulus,
    choices:[cur_left_video,cur_right_video],
    button_html: button_html_1,
    trial_duration: 6300,
    margin_top: ['300px','300px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','200px'],
    margin_right: ['100px','0px'],
    response_possible: false,
    post_trial_gap: 0,
    response_ends_trial: false,
    set_background: cur_background,
    data:{
      side1: data[i]['side1'],
      left_video: data[i]['left_video'],
      right_video: data[i]['right_video'],
      target_side: data[i]['target_side'],
      correct_response: data[i]['correct_response'],
      background: data[i]['background']},
    on_finish: function(data) {
      data.correct = data.button_pressed == data.correct_response;
    }
  }
  timeline.push(plp_trial_1);

  var plp_trial_2= {
    //present 2nd video
    type: 'audio-button-response-flexiblelocations',
    stimulus: cur_stimulus,
    choices:[cur_left_video,cur_right_video],
    button_html: button_html_2,
    trial_duration: 6300,
    margin_top: ['300px','300px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','200px'],
    margin_right: ['100px','0px'],
    response_possible: false,
    post_trial_gap: 0,
    response_ends_trial: false,
    set_background: cur_background,
    data:{
      side1: data[i]['side1'],
      left_video: data[i]['left_video'],
      right_video: data[i]['right_video'],
      target_side: data[i]['target_side'],
      correct_response: data[i]['correct_response'],
      background: data[i]['background']},
    on_finish: function(data) {
      data.correct = data.button_pressed == data.correct_response;
    }
  }
  timeline.push(plp_trial_2);

  var plp_trial_3= {
    //present both videos
    type: 'audio-button-response-flexiblelocations',
    stimulus: cur_stimulus,
    choices:[cur_left_video,cur_right_video],
    button_html: [cur_left_button_play, cur_right_button_play],
    trial_duration: 6300,
    margin_top: ['300px','300px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','200px'],
    margin_right: ['100px','0px'],
    response_possible: false,
    post_trial_gap: 0,
    response_ends_trial: false,
    set_background: cur_background,
    data:{
      side1: data[i]['side1'],
      left_video: data[i]['left_video'],
      right_video: data[i]['right_video'],
      target_side: data[i]['target_side'],
      correct_response: data[i]['correct_response'],
      background: data[i]['background']},
    on_finish: function(data) {
      data.correct = data.button_pressed == data.correct_response;
    }
  }
  timeline.push(plp_trial_3);
}

/*
//define the location of the stimuli
  var plp_trials = {
    timeline: [
      {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 6300,
      margin_top: ['300px','300px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','200px'],
      margin_right: ['100px','0px'],
      //timeline: plp_stimuli,
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.timelineVariable('choices'),
      set_background: jsPsych.timelineVariable('set_background'),
  	  response_possible: false,
      post_trial_gap: 0,
      button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>',
  '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="%choice%" type="video/mp4"></video></div>'],
      data: jsPsych.timelineVariable('data'),
  	  response_ends_trial: false,
      on_finish: function(data) {
        data.correct = data.button_pressed == data.correct_response;
      }
    },
    {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 6300,
      margin_top: ['300px','300px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','200px'],
      margin_right: ['100px','0px'],
      //timeline: plp_stimuli,
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.timelineVariable('choices'),
      set_background: jsPsych.timelineVariable('set_background'),
      response_possible: false,
      post_trial_gap: 0,
      button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="%choice%" type="video/mp4"></video></div>',
  '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>'],
      data: jsPsych.timelineVariable('data'),
      response_ends_trial: false,
      on_finish: function(data) {
        data.correct = data.button_pressed == data.correct_response;
      }
    },
    {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 6300,
      margin_top: ['300px','300px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','200px'],
      margin_right: ['100px','0px'],
      //timeline: plp_stimuli,
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.timelineVariable('choices'),
      set_background: jsPsych.timelineVariable('set_background'),
      response_possible: false,
      //post_trial_gap: 0,
      button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>',
  '<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>'],
      data: jsPsych.timelineVariable('data'),
      response_ends_trial: false,
      on_finish: function(data) {
        data.correct = data.button_pressed == data.correct_response;
      }
    }
  ],
  timeline_variables: plp_stimuli
}

  timeline.push(plp_trials);*/

/*
// define 1 plp trials
  var plp_trial = {
    timeline:[
      {
        //autoplay left side first
        type: 'audio-button-response-flexiblelocations',
        stimulus: "stimuli/sounds/acrossTheUniverse_70dB000.wav",
        choices: ["stimuli/videos/apple_typical.mp4", "stimuli/videos/apple_atypical.mp4"],
        set_background: "black-background",
        margin_top: ['300px','300px'],
        margin_bottom: ['0px','0px'],
        margin_left: ['0px','200px'],
        margin_right: ['100px','0px'],
        post_trial_gap:0,
        trial_duration: 6500,
        response_ends_trial: false,
        button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>',
		'<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="%choice%" type="video/mp4"></video></div>']
    },
    {
        //autoplay right side next
        type: 'audio-button-response-flexiblelocations',
        stimulus: "stimuli/sounds/acrossTheUniverse_70dB001.wav",
        choices: ["stimuli/videos/apple_typical.mp4", "stimuli/videos/apple_atypical.mp4"],
        set_background: "black-background",
        margin_top: ['300px','300px'],
        margin_bottom: ['0px','0px'],
        margin_left: ['0px','200px'],
        margin_right: ['100px','0px'],
        post_trial_gap:0,
        trial_duration: 6500,
        response_ends_trial: false,
        button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto"><source src="%choice%" type="video/mp4"></video></div>',
		'<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>']
    },
    {
        //autoplay both sides simultaneously
        type: 'audio-button-response-flexiblelocations',
        stimulus: "stimuli/sounds/acrossTheUniverse_70dB002.wav",
        choices:["stimuli/videos/apple_typical.mp4", "stimuli/videos/apple_atypical.mp4"],
        set_background: "black-background",
        margin_top: ['300px','300px'],
        margin_bottom: ['0px','0px'],
        margin_left: ['0px','200px'],
        margin_right: ['100px','0px'],
        post_trial_gap:0,
        trial_durations: 6500,
    	  response_ends_trial: true,
        button_html: ['<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>',
		'<div><video id="jspsych-video-button-response-stimulus" width="450" preload="auto" autoplay><source src="%choice%" type="video/mp4"></video></div>']
    }
  ]
}
  timeline.push(plp_trial);*/

  var fullscreen_exit = {
    type: 'fullscreen',
    fullscreen_mode: false
  }
  timeline.push(fullscreen_exit)
};

/*
var imageExt = 'stimuli/images/'


var images = [
"apple01.jpg",
"apple02.jpg",
"apple03.jpg",
"ball01.jpg",
"ball02.jpg",
"ball03.jpg",
"balloons_left.jpg",
"balloons_right.jpg",
"beach_left.jpg",
"beach_right.jpg",
"black-background.jpg",
"black.jpg",
"crayon01.jpg",
"crayon02.jpg",
"crayon03.jpg",
"fireworks_left.jpg",
"fireworks_right.jpg",
"ocean_left.jpg",
"ocean_right.jpg",
"toothbrush01.jpg",
"toothbrush02.jpg",
"toothbrush03.jpg"
]

var preload_images=[];

for (var k = 0; k < images.length; k++) {
	preload_images.push(imageExt+images[k]);
};
*/

var audio = [
  "acrossTheUniverse_70dB000.wav",
  "acrossTheUniverse_70dB001.wav",
  "acrossTheUniverse_70dB002.wav",
  "acrossTheUniverse_70dB003.wav",
  "acrossTheUniverse_70dB004.wav",
  "acrossTheUniverse_70dB005.wav",
  "acrossTheUniverse_70dB006.wav",
  "acrossTheUniverse_70dB007.wav",
  "acrossTheUniverse_70dB008.wav",
  "acrossTheUniverse_70dB009.wav",
  "acrossTheUniverse_70dB010.wav",
  "acrossTheUniverse_70dB011.wav",
  "acrossTheUniverse_70dB012.wav",
  "acrossTheUniverse_70dB013.wav",
  "acrossTheUniverse_70dB014.wav",
  "acrossTheUniverse_70dB015.wav",
  "acrossTheUniverse_70dB016.wav",
  "acrossTheUniverse_70dB017.wav",
  "acrossTheUniverse_70dB018.wav",
  "acrossTheUniverse_70dB019.wav",
  "acrossTheUniverse_70dB020.wav",
  "acrossTheUniverse_70dB021.wav",
  "acrossTheUniverse_70dB022.wav",
  "acrossTheUniverse_70dB023.wav",
  "acrossTheUniverse_70dB024.wav",
  "acrossTheUniverse_70dB025.wav",
  "acrossTheUniverse_70dB026.wav",
  "acrossTheUniverse_70dB027.wav",
  "acrossTheUniverse_70dB028.wav",
  "acrossTheUniverse_70dB028.wav",
  "yellow_70dB000.wav",
  "yellow_70dB001.wav",
  "yellow_70dB002.wav",
  "yellow_70dB003.wav",
  "yellow_70dB004.wav",
  "yellow_70dB005.wav",
  "yellow_70dB006.wav",
  "yellow_70dB007.wav",
  "yellow_70dB008.wav",
  "yellow_70dB009.wav",
  "yellow_70dB010.wav",
  "yellow_70dB011.wav",
  "yellow_70dB012.wav",
  "yellow_70dB013.wav",
  "yellow_70dB014.wav",
  "yellow_70dB015.wav",
  "yellow_70dB016.wav",
  "yellow_70dB017.wav",
  "yellow_70dB018.wav",
  "yellow_70dB019.wav",
  "yellow_70dB020.wav",
  "yellow_70dB021.wav",
  "yellow_70dB022.wav",
  "yellow_70dB023.wav",
  "yellow_70dB024.wav",
  "yellow_70dB025.wav",
  "yellow_70dB026.wav",
  "yellow_70dB027.wav",
  "yellow_70dB028.wav",
  "yellow_70dB028.wav"
/*
  "AG.wav",
  "apple_find.wav",
  "apple_look.wav",
  "apple_where.wav",
  "ball_find.wav",
  "ball_look.wav",
  "ball_where.wav",
  "crayon_find.wav",
  "crayon_look.wav",
  "crayon_where.wav",
  "toothbrush_find.wav",
  "toothbrush_look.wav",
  "toothbrush_where.wav"
*/
];

var preload_audio  = [];

for (var l = 0; l < preload_audio.length; l++) {
	preload_audio.push(audioExt+audio[l]);
};

var videoExt = 'stimuli/videos/'

var video= [
  "apple_typical.mp4",
  "apple_atypical.mp4",
  "ball_typical.mp4",
  "ball_atypical.mp4",
  "crayon_typical.mp4",
  "crayon_atypical.mp4",
  "toothbrush_typical.mp4",
  "toothbrush_atypical.mp4",
  "Bubbles6.mp4",
  "Clouds6.mp4",
  "Drops6.mp4",
  "Kaleidoscope6.mp4",
  "Planets6.mp4"
];

var preload_videos=[];

for (var k = 0; k < video.length; k++) {
	preload_videos.push(videoExt+video[k]);
};

function startExperiment(data) {
	createTrials(data);
  // generate all the plugins
jsPsych.init({ //js.psych initializes
  timeline: timeline,
  preload_audio:preload_audio,
  //preload_images:preload_images,
  preload_video: preload_videos,
	default_iti: 300,
  on_finish: function() {
    jsPsych.data.displayData();
  }
});
};

/*function startExperimentPLP(data_plp, tabletop_plp) {
	createPLPTrials(data_plp,tabletop_plp);
jsPsych.init({
  timeline: timeline,
  preload_audio:preload_audio,
  preload_videos:preload_videos,
	default_iti: 300,
  on_finish: function() {
    jsPsych.data.displayData();
  }
});
};*/

/*
function save_data(experiment, version,identifier, data){
 	$.ajax({
 		type: 'post',
 		cache: false,
 		url: 'https://data.infantlearning.waisman.wisc.edu/infantdb/datastore/save/',
 		data: {
 			experiment: experiment,
 	version: version,
 			identifier: identifier,
 			data: data
 		}
 	})
 };
*/


</script>

</html>
